<!DOCTYPE html>
  <html lang="en">
    <head>
      <title>Wrapped Hive</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
      <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@hiveio/hive-js/dist/hive.min.js"></script>
    </head>
    <body>

    <div class="container">
      <h2><center>HIVE to WHIVE</center></h2>
      <div id='error'></div>
      <form id="form1">
        <div class="form-group">
          <label for="eth">Ethereum address:</label>
          <input type="text" class="form-control" id="eth" placeholder="Enter Ethereum address" name="eth">
        </div>
        <button class="btn btn-primary" onClick='getNewDepositAddress()'>Submit</button>
      </form>
      <h2><center>WHIVE to HIVE</center></h2>
      <div id='error2'></div>
      <form id="form2">
        <div class="form-group">
          <label for="hive">Hive Address:</label>
          <input type="text" class="form-control" id="hive" placeholder="Enter Hive Address" name="hive">
        </div>
        <button class="btn btn-primary" onClick='getNewDepositWithdrawAddress()'>Submit</button>
      </form>
    </div>
    <script>
    function getNewDepositAddress(){
      try {
        var web3 = new Web3();
        let rawInput = document.getElementById("eth").value;
        const address = web3.utils.toChecksumAddress(rawInput)
        console.log(address)
      } catch (error) {
        console.error('invalid ethereum address', error.message)
        document.getElementById("error").innerHTML = `${error}</p>`
      }
    }
    function getNewDepositWithdrawAddress(){
      let rawInput = document.getElementById("hive").value;
      hive.api.getAccounts([rawInput], function(err2, result) {
      	if(err2) document.getElementById("error2").innerHTML = `${err2}</p>`
        else if (result.length == 0) document.getElementById("error2").innerHTML = `Account does not exists`
        else newTx(rawInput)
      });
    }
    function newTx(hive){
      $.post("/create", {'username': hive}, function(data, status){
        if(status != 'success') document.getElementById("error2").innerHTML = `Internal server error`
        else document.getElementById("error2").innerHTML = `Send WHIVE to: ${data.address}, expiration: ${new Date(data.expiration)}`
      });
    }
    $("#form1").submit(function(e){
      return false;
    });
    $("#form2").submit(function(e){
      return false;
    });
    </script>
  </body>
</html>
